<ui:composition template="/template.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
				xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions">
<ui:define name="content">
 
 <style>
.glyphicon { margin-right:5px;}
.glyphicon-heart { color:#e74c3c;}
.section-box hr {margin-top:0;margin-bottom:5px;border:0;border-top:1px solid rgb(199, 199, 199);}
 </style>
 
    <div class="row" id="content">

	 	<h:form>
			<div class="col-sm-2">

				<div class="panel panel-info">
					<div class="panel-heading">
						<h4>#{msg['categories']}</h4>
					</div>
					<div class="panel-body">
	                    <div class="single">
	                        <ul class="list-unstyled">
		                        <c:forEach var="cat" items="#{productController.categories}">
		                        	<li>
								 		<h:commandLink action="#{productController.loadItems(cat)}">
									 		#{cat.description}
									 		<span class="pull-right">
									 			#{fn:length(cat.items)}
									 		</span>
									 		<!-- <f:ajax execute="productForm" render=":productForm" /> -->
										</h:commandLink>
	                  				</li>    
	                         	</c:forEach>  
	                        </ul>
	                    </div>
					</div>		
				</div>
			</div>
	 	</h:form>     
   
	   <h:panelGroup id="productForm" >
			<div class="col-sm-10">
			  
				<c:forEach var="item" items="#{productController.items}">
		
					<div class="col-md-4">
			        	<div class="thumbnail">
			                <h:graphicImage url="image?id=#{item.id}" class="img-responsive"/>
			                <div class="caption">
			                  <h4 class="pull-right">CHF #{item.price}</h4>
			                  <h4><a href="#">#{item.title}</a></h4>
			                  <!-- <p>#{item.description}</p> -->
			                  <h:outputText value="#{fn:substring(item.description, 0, 40)}..." />
			                </div>
			                <div class="ratings">
			                  <p>
			                  	<c:forEach begin="0" end="4" var="val">						    
									<c:choose>
					                  	<c:when test="${item.seller.averageStars > (val + 0.5)}">
					                  		<span class="glyphicon glyphicon-star"></span>
					                  	</c:when>
										<c:otherwise>
											<span class="glyphicon glyphicon-star-empty"></span>
										</c:otherwise>
				                  	</c:choose>								    									    
			                  	</c:forEach>
			                    (#{fn:length(item.seller.tos)} reviews)
			                  </p>
			                </div>
			                <!-- <div class="space-ten"></div> -->
			                <div class="btn-ground text-center">
			                	<h:form>
			                		
				                   	<h:commandLink onclick="$('#product_view').modal('show');" class="btn btn-primary"
				                   				   action="#{productController.setSelectedItem(item)}">Show Detail
				                    	<f:ajax render=":dialog-detail-form" />
				                   </h:commandLink>
				                   
				                   	<h:commandLink onclick="$('#review_view').modal('show');" class="btn btn-primary"
				                   				   action="#{productController.setSelectedItem(item)}">Show Review
				                    	<f:ajax render=":reviewForm" />
				                   </h:commandLink>
				                   
			                   </h:form>
			                   <!-- <button type="button" class="btn btn-primary"><i class="fa fa-shopping-cart"></i> Add To Cart</button> -->
			                    <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#product_view"><i class="fa fa-search"></i> Quick View</button> -->
			                </div>
			                <div class="space-ten"></div>
			              </div>
					</div>            
		            
				</c:forEach>    
			
			</div>
		</h:panelGroup>
    </div>


<div class="modal fade product_view" id="product_view">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <a href="#" data-dismiss="modal" class="class pull-right"><span class="glyphicon glyphicon-remove"></span></a>
                <h3 class="modal-title">Produkt Detail</h3>
            </div>
            <div class="modal-body">
                <div class="row">
                
	                <h:form id="dialog-detail-form">
	                
	                    <div class="col-md-6 product_img">
	                        <h:graphicImage url="image?id=#{productController.selectedItem.id}" class="img-responsive"/>
	                    </div>
	                    <div class="col-md-6 product_content">
	                        <h4><span>#{productController.selectedItem.title}</span></h4>
	                        <div class="rating">
	                            <span class="glyphicon glyphicon-star"></span>
	                            <span class="glyphicon glyphicon-star"></span>
	                            <span class="glyphicon glyphicon-star"></span>
	                            <span class="glyphicon glyphicon-star"></span>
	                            <span class="glyphicon glyphicon-star"></span>
	                            (10 reviews)
	                        </div>
	                        <p>
	                        	<h:outputText value="#{productController.selectedItem.description}"/>
	                        </p>
	                        <h3 class="cost">
								<h:outputText value="#{productController.selectedItem.price}">
									<f:convertNumber currencySymbol="CHF " type="currency" />
								</h:outputText>
							</h3>
								
	                        <div class="space-ten"></div>
	                        <div class="btn-ground">
	                            <button type="button" class="btn btn-primary"><span class="glyphicon glyphicon-shopping-cart"></span> Add To Cart</button>
	                            <button type="button" class="btn btn-primary"><span class="glyphicon glyphicon-heart"></span> Add To Wishlist</button>
	                        </div>
	                    </div>
                    
                    </h:form>
                    
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="review_view"> 
    <div class="modal-dialog" style="overflow-y: scroll; max-height:85%;  margin-top: 50px; margin-bottom:50px;"> 
        <div class="modal-content"> 
            <div class="modal-header"> 
            	<a href="#" data-dismiss="modal" class="class pull-right"><span class="glyphicon glyphicon-remove"></span></a>
                <h3 class="modal-title">Vek√§ufer-Bewertung</h3>
            </div> 
            <div class="modal-body">
            	<h:form id="reviewForm">
            	
	           		<c:forEach var="rating" items="${productController.selectedItem.seller.tos}">
	           		
		           		<div class="row">
	
							<div class="col-md-12 section-box">
		                        <h4>Bootsnipp</h4>
		                        <p><h:outputText value="#{rating.commentary}"/></p>
		                        <hr/>
								<div class="ratings">
			           				<p>
			           					<c:forEach begin="0" end="4" var="val">						    
			           						<c:choose>
						              			<c:when test="${rating.stars > (val + 0.5)}">
						              				<span class="glyphicon glyphicon-star"></span>
						              			</c:when>
												<c:otherwise>
													<span class="glyphicon glyphicon-star-empty"></span>
												</c:otherwise>
						             		</c:choose>								    									    
						            	</c:forEach>
						            </p>
		           				</div>
		                    </div>
		           		</div>
	           			
	           		</c:forEach>
          		</h:form>
          	</div> 
            <div class="modal-footer">ASDFASDFASDFASDF</div> 
        </div> 
    </div> 
</div>

</ui:define>
</ui:composition>